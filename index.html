<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1.0, minimum-scale=1.0, maximum-scale=1.0" />
    <title>XKCD password generator</title>
    <link rel="stylesheet" type="text/css" href="./res/style.css" />
  </head>
  <body>
    <script>
      async function makePassword({ wordlistUrl, integrity }) {
        // Download wordlist and check its integrity
        const wordlist = await fetch(wordlistUrl, { integrity }).then((res) => res.text());

        // Extract words using regular expression, it matches to words after 5 digits and tab
        const words = [...wordlist.matchAll(/[0-9]{5}	(.*)/g)].map(([, word]) => word);

        // Prepare array for random numbers
        const passwordWordIds = new Uint16Array(4);

        // Fill it by crypto strong pseudo random numbers
        crypto.getRandomValues(passwordWordIds);

        // Map each number to word. We use 4 words with 4096 combinations, thats 12 bits of entropy per word, 48 bits total
        return [...passwordWordIds].map((id) => words[id % 4096]).join(" ");
      }

      window.addEventListener("DOMContentLoaded", () => {
        Promise.all([
          // Don't trust integrity verification, lets check it.
          // Open https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt
          // Press F12 and write
          // await fetch(location.href, { integrity: 'sha384-08Zyc2ydrI+QM7TP2c1fgd3aA/gqwudW0UMg0DqfFf0fqP4CVuU45K7lnlUry9Ts' }).then((res) => res.text())
          // You will see content, integrity check succeessful
          // Change one symbol in integrity except sha384-, thats hash type and evaluate it
          // You will see integrity error
          makePassword({ wordlistUrl: "./res/eff_large_wordlist.txt", integrity: "sha384-08Zyc2ydrI+QM7TP2c1fgd3aA/gqwudW0UMg0DqfFf0fqP4CVuU45K7lnlUry9Ts" }),
          // Don't trust integrity verification, lets check it.
          // Open https://theworld.com/%7Ereinhold/diceware.wordlist.asc
          // Press F12 and write
          // await fetch(location.href, { integrity: 'sha384-4n493bkdsfRTGItNlVLnGkWyGb/YfACD/+Iu6/yor5D06tbp3cAZAFzM2z8SIJYe' }).then((res) => res.text())
          // You will see content, integrity check succeessful
          // Change one symbol in integrity except sha384-, thats hash type and evaluate it
          // You will see integrity error
          makePassword({ wordlistUrl: "./res/diceware_wordlist.txt", integrity: "sha384-4n493bkdsfRTGItNlVLnGkWyGb/YfACD/+Iu6/yor5D06tbp3cAZAFzM2z8SIJYe" }),
        ])
          // Make message
          .then(
            (passwords) =>
              "<div>Your 48-bit entropy EFF list password:</div>" +
              '<div class="password-text">' +
              passwords[0] +
              "</div>" +
              "<div>Your 48-bit entropy diceware(tm) list password:</div>" +
              '<div class="password-text">' +
              passwords[1] +
              "</div>" +
              "<div>Good enough to be a master password, keep secret. Refresh page if you want another</div>"
          )
          // Intercept error
          .catch(() => "Error while generating password")
          // Put into page
          .then((message) => (document.querySelector(".password").innerHTML = message));
      });
    </script>
    <object data="./res/eff_large_wordlist.txt">
      <!-- If you want save this page to operate offline, browser will know to download this files too -->
    </object>
    <object data="./res/diceware_wordlist.txt">
      <!-- If you want save this page to operate offline, browser will know to download this files too -->
    </object>
    <div class="languages">
      <a href="./index.html" class="language-selector">ðŸ‡ºðŸ‡¸</a>
      <a href="./ru.html" class="language-selector">ðŸ‡·ðŸ‡º</a>
    </div>
    <div class="description">
      <div class="description-text">Nothing upon my sleeve in-browser XKCD password generator (unofficial).</div>
      <div class="description-text">
        Lightweight, no JS dependencies, based on <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API" target="_blank" rel="noopener">Web Crypto API</a> and
        <a href="https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt" target="_blank" rel="noopener">EFF word list</a>.
      </div>
      <div class="description-text">
        <b>Don't trust, add <code>view-source:</code> before URL and check, its well commented.</b>
      </div>
      <div class="description-text">For more secure operation, use incognito mode to disable extensions.</div>
    </div>
    <img src="./res/wow.jpeg" class="wow" />
    <div class="password-container">
      <div class="password">Generating...</div>
    </div>
    <div class="xkcd-line">
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd1.png" class="xkcd-image" />
      </a>
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd2.png" class="xkcd-image" />
      </a>
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd3.png" class="xkcd-image" />
      </a>
    </div>
    <div class="xkcd-line">
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd4.png" class="xkcd-image" />
      </a>
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd5.png" class="xkcd-image" />
      </a>
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd6.png" class="xkcd-image" />
      </a>
    </div>
    <div class="xkcd-line">
      <a href="https://xkcd.com/936/" target="_blank" rel="noopener" class="xkcd-item">
        <img src="./res/img-en/xkcd7.png" class="xkcd-image" />
      </a>
    </div>
  </body>
</html>
